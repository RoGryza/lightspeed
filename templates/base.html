{% import "macros.html" as macros %}
{%- set lang = lang | default(value=config.default_language) -%}
{%- if page is defined -%}
{%- set translations = page.translations -%}
{%- elif section is defined -%}
{%- set translations = section.translations -%}
{%- else -%}
{%- set translations = [] -%}
{%- endif -%}
{%- if lang != config.default_language -%}
{# translations doesn't seem to contain default_language by default #}
{%- set def_translation = { lang = config.default_language, permalink=get_url(
{%- set translations = translations | concat(with=[{ lang = config.default_language
{%- endif -%}

<!DOCTYPE html>
<html lang="{{ lang }}">
  {% block head %}
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>{% block title %}{{ trans(key="title", lang=lang) }} &middot; {{ trans(key="description", lang=lang) }}{% endblock title %}</title>
    <meta name="description" content="{% block description %}{{ trans(key="description", lang=lang) }}{% endblock description %}" />
    <link rel="shortcut icon"  href="{{ get_url(path="favicon.ico") | safe }}" />
    {# workaround for https://github.com/getzola/zola/issues/1250 #}
    <link rel="alternate" type="application/atom+xml" title="RSS" href="{{ macros::lang_url(path="atom.xml") | safe }}">
    {%- set translations = page.translations | default(value=section.translations) | default(value=[]) -%}
    {% for translation in translations -%}
    {%- if translation.lang != lang -%}
    <link rel="alternate" href="{{ translation.permalink | safe }}" hreflang="{{ translation.lang }}"/>
    {%- endif -%}
    {%- endfor %}

    <link rel="stylesheet" href="/style.css"/>

    {% block seo -%}
      <meta property="og:site_name" content="{% block ogsitename %}{{config.title}}{% endblock ogsitename %}">
      {% if config.extra.author -%}
        <meta name="author" content="{{ config.extra.author }}" />
      {%- endif %}
      <meta property="og:title" content="{% block ogtitle %}{{config.title}}{% endblock ogtitle %}">
      <meta property="og:description" content="{% block ogdesc %}{{config.description}}{% endblock ogdesc %}">
      <meta property="og:url" content="{% block ogurl %}{{config.base_url | safe }}{% endblock ogurl %}">
      <meta property="og:image" content="{% block ogimage %}{% if config.extra.ogimage %}{{ get_url(path=config.extra.ogimage) | safe }}{% endif %}{% endblock ogimage %}">

      {% if page.date -%}
        <meta property="og:type" content="article" />
        <meta property="article:published_time" content="{{ page.date | date(format="%+") }}" />
      {%- endif %}

      {% if page.earlier -%}
        <link rel="prev" href="{{ page.earlier.permalink | safe }}" />
      {%- endif %}
      {% if page.later -%}
        <link rel="next" href="{{ page.later.permalink | safe }}" />
      {%- endif %}
    {%- endblock seo -%}

    {% block extra_head %}
    {% endblock extra_head %}

  </head>
  {% endblock head %}

  <body>
    <main id="main" role="main">

      {% block header %}
      <header role="banner">
        <h3 style="margin-top:0;">
          <a href="{{ macros::lang_url(path="/") | safe }}" title="Home">{{ trans(key="title", lang=lang) }}</a>
          <br /><small>{{ trans(key="description", lang=lang) }}</small>
        </h3>
        {% if config.extra.nav_links %}
        <nav style="margin-bottom:1rem;" role="navigation">
          {% for item in config.extra.nav_links %}
            {%- if item.feed -%}
            {%- set item_url = get_url(path=feed_path) -%}
            {%- elif item.url is starting_with("http") -%}
            {%- set item_url = item.url -%}
            {%- elif item.lang -%}
            {%- set item_url = item.url -%}
            {%- else -%}
            {%- set item_url = get_url(path=item.url, lang=lang) -%}
            {%- endif -%}
            <a href="{{ item_url }}">
              {{ macros::maybe_trans(key=item.name) }}
            </a>
            {% if loop.last %}{% else %}
              <span>&middot;</span>
            {% endif %}
          {% endfor %}
        </nav>
        {% endif %}
      </header>
      <hr />
      {% endblock header %}

      {% block content %}
      {% endblock content %}

      {% block footer %}
      <footer role="contentinfo">
        <hr />
        {% block taglines %}
        <small>
          Built with <a href="https://www.getzola.org/">Zola</a> using an adapted
          <a href="https://github.com/carpetscheme/lightspeed">lightspeed</a> theme.
          {% block extra_taglines %}
          {% endblock %}
        </small>
        {% endblock taglines %}
      </footer>
      {% endblock footer %}

    </main>
    {% block after_main %}
    {% endblock after_main %}
  </body>
</html>

